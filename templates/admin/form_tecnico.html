{% extends 'base.html' %}
{% block title %}{% if tecnico %}Editar T√©cnico{% else %}Nuevo T√©cnico{% endif %}{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h2 class="h4 mb-0">
    {% if tecnico %}‚úèÔ∏è Editar T√©cnico: {{ tecnico.display_name }}{% else %}üë§ Nuevo T√©cnico{% endif %}
  </h2>
  <a href="{{ url_for('admin.index') }}" class="btn btn-sm btn-outline-secondary">‚Üê Volver</a>
</div>

<div class="row justify-content-center">
  <div class="col-12 col-md-8 col-lg-6">
    <div class="card shadow-sm border-0">
      <div class="card-header fw-semibold bg-primary text-white">
        {% if tecnico %}Editar perfil{% else %}Crear nuevo t√©cnico{% endif %}
      </div>
      <div class="card-body">
        <form method="POST">

          {% if not tecnico %}
          <!-- Usuario (solo en creaci√≥n) -->
          <div class="mb-3">
            <label class="form-label fw-semibold">Usuario <span class="text-danger">*</span></label>
            <input type="text" name="username" class="form-control"
                   placeholder="nombre_usuario" required autocomplete="off">
            <div class="form-text">Solo letras, n√∫meros y guiones. Sin espacios.</div>
          </div>
          {% else %}
          <div class="mb-3">
            <label class="form-label fw-semibold">Usuario</label>
            <input type="text" class="form-control" value="{{ tecnico.username }}" disabled>
          </div>
          {% endif %}

          <!-- Contrase√±a -->
          <div class="mb-3">
            <label class="form-label fw-semibold">
              Contrase√±a {% if not tecnico %}<span class="text-danger">*</span>{% endif %}
            </label>
            <input type="password" name="password" class="form-control"
                   {% if not tecnico %}required{% endif %}
                   placeholder="{% if tecnico %}Dejar vac√≠o para no cambiar{% else %}Contrase√±a segura{% endif %}"
                   autocomplete="new-password">
            {% if tecnico %}
            <div class="form-text">Dejar vac√≠o para mantener la contrase√±a actual.</div>
            {% endif %}
          </div>

          <hr class="my-3">

          <!-- Nombre completo -->
          <div class="mb-3">
            <label class="form-label fw-semibold">Nombre completo</label>
            <input type="text" name="nombre_completo" class="form-control"
                   value="{{ tecnico.nombre_completo or '' if tecnico else '' }}"
                   placeholder="Nombre y apellidos">
          </div>

          <!-- Tel√©fono -->
          <div class="mb-3">
            <label class="form-label fw-semibold">Tel√©fono de contacto</label>
            <input type="tel" name="telefono_perfil" class="form-control"
                   value="{{ tecnico.telefono_perfil or '' if tecnico else '' }}"
                   placeholder="600 000 000">
          </div>

          <!-- Telegram Chat ID -->
          <div class="mb-3">
            <label class="form-label fw-semibold">Telegram Chat ID</label>
            <input type="text" name="telegram_chat_id" class="form-control"
                   value="{{ tecnico.telegram_chat_id or '' if tecnico else '' }}"
                   placeholder="Ej: 123456789">
            <div class="form-text">
              Para recibir notificaciones. El t√©cnico puede obtener su ID hablando con
              <a href="https://t.me/userinfobot" target="_blank" rel="noopener">@userinfobot</a>.
            </div>
          </div>

          <!-- Rol -->
          <div class="mb-3">
            <label class="form-label fw-semibold">Rol</label>
            <select name="rol" class="form-select"
                    {% if tecnico and tecnico.username == 'admin' %}disabled{% endif %}>
              <option value="tecnico" {% if tecnico and tecnico.rol == 'tecnico' %}selected{% elif not tecnico %}selected{% endif %}>
                T√©cnico
              </option>
              <option value="admin" {% if tecnico and tecnico.rol == 'admin' %}selected{% endif %}>
                Administrador
              </option>
            </select>
            {% if tecnico and tecnico.username == 'admin' %}
            <div class="form-text text-warning">El usuario admin siempre es administrador.</div>
            {% endif %}
          </div>

          <div class="d-flex gap-2 mt-4">
            <button type="submit" class="btn btn-primary flex-grow-1">
              {% if tecnico %}üíæ Guardar cambios{% else %}‚úÖ Crear t√©cnico{% endif %}
            </button>
            <a href="{{ url_for('admin.index') }}" class="btn btn-outline-secondary">Cancelar</a>
          </div>

        </form>
      </div>
    </div>
  </div>
</div>
{% endblock %}
